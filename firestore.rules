rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // --- Collection: janazas ---
    match /janazas/{janazaId} {
      // Lecture : Publique
      allow read: if true;
      
      // Création : Authentifié + Doit marquer le bon UID
      allow create: if request.auth != null 
                    && request.resource.data.created_by == request.auth.uid;
      
      // Modif/Suppression : Seulement le créateur
      allow update, delete: if request.auth != null 
                            && resource.data.created_by == request.auth.uid;
    }

    // --- Collection: saved_janazas (Les favoris/suivis) ---
    match /saved_janazas/{saveId} {
      // Lecture : Uniquement mes propres favoris
      allow read: if request.auth != null 
                  && resource.data.user_id == request.auth.uid;

      // Création : Authentifié + Je dois m'enregistrer moi-même
      allow create: if request.auth != null 
                    && request.resource.data.user_id == request.auth.uid;
      
      // Suppression : Uniquement mes propres favoris
      allow delete: if request.auth != null 
                    && resource.data.user_id == request.auth.uid;
    }
    
    // --- Collection: users (Optionnel pour le futur) ---
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
